# Heirlink — Документация

**Heirlink** — dApp для сохранности цифрового капитала и передачи его наследникам по смарт-контракту (Dead Man's Switch).

---

## Обзор

**Идея:** вы задаёте токены (ERC-20 и опционально ETH) и наследников с долями в %. Приложение строит [**Merkle tree**](https://forklog.com/cryptorium/chto-takoe-derevo-merkla) (корень + пруфы на каждого наследника) и записывает данные в **хранилище (vault)**. Пока вы подтверждаете активность — хранилище под вашим контролем; при длительной неактивности наследники забирают средства по пруфам.

**Схема работы:**

- **Наследство** — ввод токенов и наследников → «Сгенерировать Merkle tree» → скачивание файлов (merkleTree.json + heir\_\*.json) + транзакция (создание/обновление vault с root и списком токенов).
- **Vault** — хранит список токенов (включая адрес для ETH) и Merkle root; владелец может выводить токены и ETH до истечения периода DMS.
- **Управлять наследством** — просмотр vault и root, подтверждение активности (DMS), балансы (ваши и хранилища), вывод токена/ETH, таблица долей по загруженному merkleTree.json, изменение периода.
- **Получить наследство** — для наследников: загрузка файла heir\_\*.json, просмотр наследодателя и хранилища, таблица «вам положено» по токенам, последняя активность и оставшееся время до конца периода, кнопка получения доли (claimWithProof).
- **Тесты** — Shamir Secret Sharing и проверка Merkle proof по двум файлам.

**Файлы:**

- _merkleTree.json_ — root, токены, листья, наследники (для восстановления и проверки).
- _heir\_\<id\>\_\<имя\>.json_ — данные одного наследника: **owner** (адрес наследодателя), sharesBps, leaf, proof. Адрес vault при получении наследства берётся через фабрику: `factory.vaults(owner)`.

**DMS и наследники:** при создании vault задаётся период неактивности (в днях). Владелец периодически нажимает «Подтвердить активность»; может включить DMS, отменить DMS или изменить период. **Отдельного шага «запуск распределения» нет** — после истечения периода и при включённом DMS наследники сразу вызывают **claimWithProof** (адрес, heirId, sharesBps, proof из heir\_\*.json) и получают свою долю. Каждый лист забирается один раз.

**Токены и ETH:** в контракт передаётся список токенов, включая адрес-заполнитель для ETH (0xEee...). На страницах управления и получения наследства ETH отображается как «ETH», балансы считаются нативно. Сеть и адреса — в `contracts/addresses.json`, подключите кошелёк к этой сети.

---

## Разделы

- **[Распределение наследства](inheritance)** — форма, доли, генерация дерева, результат и транзакция.
- **[Управление наследством](manage)** — vault, DMS, балансы, вывод, таблица по файлу.
- **[Получить наследство](claim)** — для наследников: загрузка файла, информация о периоде, получение доли.
- **[Тесты](secret)** — Shamir и проверка Merkle proof.

---

## Начало работы

1. Подключите кошелёк к сети Hoodi.
   - [Кран для получения тестовых токенов](https://cloud.google.com/application/web3/faucet/ethereum/hoodi)
2. **Наследство** — создайте дерево, подтвердите транзакцию.
3. **Управлять наследством** — подтверждайте активность, смотрите vault и балансы, при необходимости выводите средства.
4. **Получить наследство** (для наследников) — загрузите heir\_\*.json, дождитесь истечения периода при необходимости и нажмите «Получить наследство».
5. **Тесты** — временная страница для проверки доказательств и разделения секрета
